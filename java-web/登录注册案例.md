### 项目分析:
#### 功能：
> 注册
>
> 登录

#### JSP
- login.jsp-->登录表单
- regiest.jsp-->注册表单
- index.jsp-->主页(只有登录成功才能看到)

#### Servlet
- loginServlet
- RegiestServlet

#### Service
- UserService-->与用户相关的业务类

#### Dao
- UserDao-->与用户相关的数据类

#### Domain
- User(对应数据库，还要对应所有表单)
```
属性：
username
password
verifyCode
....
```

#### 数据库设计
users.xml
```xml
<users>
    <user username="xxx" password="xxx">
    <user username="xxx" password="xxx">
</users>
```

### 步骤：
- **1.创建空项目**
- **2.导包**

    ***CommonUtils***
    ***commons-beanutils.jar***
    ***commons-loging.jar***
    ***dom4j***
- **3.建包**
```
user.domain
    >User
user.dao
    >UserDao
user.service
    >UserService
user.web.servlet
    >LoginServlet
    >RegisterServlet
```
- **4.jsp**
```
login.jsp
register.jsp
index.jsp
```

- **5.在F盘下创建一个users.xml**
 
添加根元素，==必须保证文件时utf-8的==


****
### 完成功能：
#### 注册
**1. register.jsp**
>第一步:完成regist.jsp的基本功能

**2. RegisterServlet**
> 封装表单数据，封装到User对象中
>
>调用service的regist方法
>- 如果这个方法没有问题，给页面显示注册成功信息
>- 如果这个方法抛出异常，把错误信息保存到request域中，转发到regist.jsp页面（显示错误信息）

**3. UserService#regist()**
> - 没有返回值，单注册失败抛出一个自定义异常，可以在异常中添加异常信息(自定义一个异常类)
>
> - 校验用户名是否已被注册（通过用户名查询用户），如果已被注册，抛出异常，异常信息为"用户名已被注册！"
>
> - 添加用户

**4. UserDao**

***通过业务分析得到结果，需提供两个方法：***
>- 按用户名查询用户对象：User findByUsername(String username)
>- 插入一个用户到数据库中:void add(User user)

****
工作：

**1.在service层添加一个UserException**

**2.dao**
>- User findByUsername(String username)
>- void add(User user);

**3.service**
>- void regist() throw UserException

**4.servlet**

>- 1).封装表单数据到User对象中
>
>- 2).使用user调用service的regist()方法
>
>- 3).如果得到UserException，那么把异常信息保存到request域中，转发回regist.jsp页面
>
>- 4).输出”注册成功“

***
#### 给注册添加验证码
**1.VerifyCode类**
> BufferedImage DrawImage() --> 获取随机的验证码
>
> String getText() --> 获取图片上的文本
>
> static output(BufferedImage,OutputStream) 
-->把图片写到指定的输出流中

**2.VerifyCodeServlet**
> 获取随机验证码图片
>
> 把验证码图片上的文本保存到session域中
>
> 把图片响应到response的Outputstream中

**3.regist.jsp**
> 添加<img src="指向Servlet'/>
>
> 添加一个文本框用来输入验证码
>
> “看不清，换一张”，是一个超链接，把上面的<img />
的src重新再次只想一个Servlet!为了处理浏览器的缓存，需要使用时
间来做参数！

4.修改RegistServlet
> 校验验证码
>
> 错误保存表单数据到request域中，保存错误信息到request域中，
转发回regist.jsp
>
> 正确,什么都不做,向下执行原来代码

#### 服务器端表单校验
我们把这段校验放到获取表单数据之后，验证码校验之前

- **1.使用Map类型来封装数据错误**
> key:表单项名称，例如：username、password、verifyCode
>
> value:
> 非空：用户名不能为空，或者是密码不能为空
>
> 长度:用户名或密码必须在3-20之间，密码长度必须在 3-20之间
>
- **2.在校验失败时,向map添加错误信息！哪个字段出错，就给哪个字段添加错误信息**

- **3.判断map是否为空（长度是否为0），如果为空，说明有错误存在，保存map到request中，保存form到request域中（回显）,转发会regist.jsp**

- **4.在regist.jsp页面中显示map中的错误信息${map.username}**

****
#### 登录功能
- 页面：login.jsp--->登录表单

- LoginServlet

> 1.获取表单数据,封装到user中
>
> 2.调用service的login()方法，传递form过去
>
> 3.如果service的login()方法，没有异常返回一个User对象
> 4.有异常，获取异常信息，保存到request域中,保存form，转发到login.jsp
>
> 5.没有异常，保存返回的user对象到session中，重定向到index,jsp显示

- UserService#login()

> public User login(User form){....}
>
> 1.使用用户名查询数据库，得到返回的User
>
> 返回为null，抛出异常，异常信息为用户名不存在
>
> 返回不为null，获取查询出来的user的password与form的password进行比较！如果不同抛出异常信息（密码错误）
>
> 如果相同，返回查询结果

- UeserDao
>1.通过用户名查询用户（已经存在，不用再写）